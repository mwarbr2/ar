<!--
/*

	https://jeromeetienne.github.io/AR.js/three.js/examples/marker-training/examples/generator.html

*/


-->

	<!DOCTYPE html>
	<html>
		<head>
			<title>Realidade Aumentada -Espaço Instagramável Casa Aberta 2019</title>

			<meta charset="utf-8">

			<!-- tag meta de controle do cache do navegador -->
			<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
			<meta http-equiv="Pragma" content="no-cache">
			<meta http-equiv="Expires" content="0">

			<!--Colocamos O Framework A-Frame que será responsavel por inserir objetos na cena-->

			<script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>

			<!--Colocamos o Framework AR.js que será responsável por reconhecer
			 o marcador onde o objeto será inserido--->

			 <script src = "https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>

		</head>
	<body style = "margin:0; overflow:hidden;">

		<!--tag não padrão do html onde nossa cena de RA seá adicionada (todos os itens vão dentro dela)-->
		<a-scene embedded arjs>
			
			<!-- carregamento do Obj 3D -->
			<a-entity obj-model="obj: url(Astronaut.obj); 
		mtl: url(Astronaut.mtl)" scale="0.5 0.5 0.5" rotate="0 0 0" ></a-entity>


			<!--Cria e posiciona um cubo sobre o marcador
			<a-plane postition = " 0 0 0 " rotation="0 0 0" color="#FFFF00"></a-plane> --><!-- #4CC3D9-->

			<!--chamada do código do marcador HIRO marcador padrão do AR.js-->

			<!-- preset = "hiro" quando usamos o marcador padrão do AR.js  

			Carregando nosso próprio marcador 
			
			type="pattern" patternUrl="marcadores/pattern-marcador01.patt"
			 -->

		<a-marker-camera preset = "hiro"  ></a-marker-camera>
		

		<button ontouchstart="captura();" id="snap-button" style="display: block; position: fixed;top: 0; left: 30%; z-index: 2000;padding: 20px;">Capturar a Foto!</button>

		</a-scene>


		<script defer type="text/javascript">
			
		function resizeCanvas(origCanvas, width, height) {
	        let resizedCanvas = document.createElement("canvas");
	        let resizedContext = resizedCanvas.getContext("2d");

	        resizedCanvas.height = height;
	        resizedCanvas.width = width;

	        if (width > height) {
	            // Landscape
	            resizedContext.drawImage(origCanvas, 0, 0, width, height);
	        } else {
	            // Portrait
	            /*var scale = height / width;
	            var scaledHeight = origCanvas.width * scale;
	            var scaledWidth = origCanvas.height * scale;
	            var marginLeft = ( origCanvas.width - scaledWidth) / 2;
	            resizedContext.drawImage(origCanvas, marginLeft, 0, scaledWidth, scaledHeight);*/
	            resizedContext.drawImage(origCanvas, 0, 0, height, width);
	        }

        	return resizedCanvas.toDataURL();
    }

		 function captura() {
				let aScene = document.querySelector("a-scene").components.screenshot.getCanvas("perspective");
				let frame = captureVideoFrame("video", "png");
				aScene = resizeCanvas(aScene, frame.width, frame.height);
				frame = frame.dataUri;
				mergeImages([frame, aScene]).then(b64 => {
					let link = document.getElementById("download-link", "png");
					link.setAttribute("download", "AR.png");
					link.setAttribute("href", b64);
					link.click();
				});
			}
					

		</script>

		</body>
	</html>
